(function(n,p,u){n.execute(function(){n.when("A","dp-refresh-handler").register("page-refresh-view",function(d,k){var h=d.$;return function(f,c,a){function g(){h.each(c.contextMetaData,function(b,l){var a={},e=l.elementList||[],c=e.length,m=[];a.click={};a.mouseOver={};for(var g=0;g<c;g++){var q=h("#"+e[g].divToUpdate);m.push("#"+e[g].divToUpdate);q.length&&e[g].customClientFunction&&(e[g].updateOnHover&&(a.mouseOver[e[g].divToUpdate]=q.attr("customfunctionname")),a.click[e[g].divToUpdate]=q.attr("customfunctionname"))}t.config[b].affectedFeatures=
m.join(",");t.config[b].clientFeatures=a})}function e(b,l,a){h.each(t.config[a].clientFeatures.click,function(a,e){try{var c=u,c=eval(e);c(l,DetailPage.StateController,function(){t.twisterRefreshHandler.stampImageLoad(b)})}catch(m){n.logFatal("Client feature - "+a+", threw and exception :- "+m)}})}function b(b,l,a,e){var c={},m={};c.asinList=b;c.id="parent"===a?b:"partial"===e?l:b;c.mType=a;c=q(a,c);a=!1;(e=d.state("pwState"))&&(a=e.isTryState);a&&(c.isTryState=a);c=t.twisterRefreshHandler.createCustomParamsMap({},
c);m.asin=b;m.id=l;return{twisterRefreshParams:c,notifyClientParams:m}}function q(b,a){h.each(c.contextMetaData[b].mTypeSpecificURLParams,function(b,l){a[b]=l});return a}function l(b){b=t.twisterUtil.getSelectionInfoFromSelectedVariationValuesMap(b.selected_variation_values);t.twisterUtil.isFullySelected(b)?t.currentPageSelectionState="full":t.currentPageSelectionState="partial"}function r(b){var a={};b=b.twisterUpdateURLInfo.immutableURLPrefix;b+="&isFlushing=2&dpEnvironment="+Twister.dpEnvironment;
a.pageRefreshUrl=b;return a}function m(b){var a={};a.config=b.measurement;a.dimensionDisplayType=b.dimensionsDisplayType;a.storeID=b.storeID;a.productGroupID=b.productGroupID;return a}function G(b,a){var l;"partial"===b&&"partial"===a&&(l="partial");"partial"===b&&"full"===a&&(l="full");"full"===b&&"partial"===a&&(l="parent");"full"===b&&"full"===a&&(l="full");return l}var t=this,x=p.ue,n=new a("dpTwisterPageRefreshView");this.twisterUtil=f.util;this.twisterFeatureName="Twister";this.currentPageSelectionState;
this.twisterRefreshHandler;this.config={partial:{},full:{},parent:{},master:{}};this.hiddenFeatures={intermediateEOS:1,EOS:1};var z=function(b){x&&x.count&&x.count(b,(x.count(b)||0)+1)};(function(){l(c);g();var a={featureName:t.twisterFeatureName},q=r(c),d=m(c);t.twisterRefreshHandler=new k(a,q,d);f.registerPassive({viewAttribution:"DetailPage",viewName:"WebTwisterRefresh"},{updateView:function(a,l){if("METADATA"===a){var m=l.newDimCombID,g=l.childAsin,q=l.newAsin,d=t.twisterUtil.isFullySelected(m)?
"full":"partial",f=G(t.currentPageSelectionState,d),r="parent"===f?!0:!1,k={},x=[];"parent"===f?(k=b(q,m,"parent",d),x.parent=k,k=b(g,m,"partial",d),x.partial=k):(k=b(g,m,f,d),x[f]=k);var m={chunk:function(b){var a=b.ASIN,l=b.Value;b=b.FeatureName;if(!t.hiddenFeatures[b]){var e,c;try{b&&l&&l.content&&(c=l.content[b],"undefined"!==typeof c&&(e=h("#"+b),e.html(c),e.css({opacity:""})))}catch(m){b=b||"NoFeatureName",n.logFatal(m,{message:"Error in feature"+b})}t.twisterRefreshHandler.stampFeature(b,a)}},
success:function(b,a,l){z("twisterUpdateSuccess")},error:function(b,a,l){Twister.$("#variations-overlay").hide();z("twisterUpdateFailure");Twister.showErrorMessageOnFailure&&(alert(Twister.errorMessageOnFailure),location.reload())},abort:function(b){n.logFatal("Ajax aborted: "+b)},timeout:4E4},D;for(D in x)if(x.hasOwnProperty(D)){if("full"===D){var y;null!=typeof l.divMetaData&&(y=l.divMetaData.dimDisplayType);k=t.twisterUtil.getDimensionInfo().length;t.twisterRefreshHandler.startMeasurement(q,y,
k,c.dimensionsDisplayType)}h(t.config[D].affectedFeatures).css({opacity:.5});k=x[D].twisterRefreshParams;g=x[D].notifyClientParams;t.twisterRefreshHandler.doPageRefresh(null,k,m,r);e(g.asin,g.id,D)}t.currentPageSelectionState=d}}})})()}})})})(function(){var n=window.AmazonUIPageJS||window.P,p=n._namespace||n.attributeErrors;return p?p("DetailPageTwisterViewAsset"):n}(),window);