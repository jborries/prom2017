(function(n,p,u){n.execute(function(){n.when("twister-variation-matrix","twister-dim-util","twister-state-machine","twister-metadata","twister-view-controller","twister-dispatcher","twister-actions","twister-slots-dimsum","twister-dimsum").register("TwisterCore",function(d,k,h,f,c,a,g,e,b){function n(g,l){this.tvm=new d(g);this.util=new k(this.tvm);this.tsm=new h(this.tvm,this.util,g.initDimCombination);this.dimSum=new b(g.config.ajaxTimeout,g.config.ajaxUrlParams,g.config.deviceType,l);this.slotsDimSum=
new e(g.config.ajaxTimeout,g.config.ajaxUrlParams,g.config.deviceType);var p=this;a.registerStore("twister-state-machine",function(b,a){p.tsm.accept(b,a).THEN(function(a){c.publishView(b,a)}).ELSE()});var q=new f;a.registerStore("twister-metadata",function(b,a){q.process(b,a,function(a){c.publishView(b,a)})})}function l(b,c){var d=b.viewAttribution+"_"+b.viewName+"_"+c;return function(b){try{var e=g.create(c,b);a.dispatch(c,e)}catch(f){p.ueLogError&&p.ueLogError(f,{logLevel:"ERROR",attribution:"Twister_view_"+
d,message:"This error is caused by the Twister view - "+d+" while updating the TwisterCore"})}}}n.prototype={registerActive:function(b,a){c.register(b.viewAttribution+"_"+b.viewName,a.updateView);return{dimensionChanged:l(b,"VARIATION_CHANGE"),dimensionPeek:l(b,"VARIATION_PEEK"),metaData:l(b,"METADATA")}},registerPassive:function(b,a){c.register(b.viewAttribution+"_"+b.viewName,a.updateView);return{metaData:l(b,"METADATA")}},state:function(){return this.tsm.currentState().selected().selectionInfo()}};
return n});n.when("A").register("twister-actions",function(d){var k=d.$,h={VARIATION_CHANGE:function(d){return d=k.isArray(d)?d:[d]},VARIATION_PEEK:function(d){return d},METADATA:function(d){return d}};return{create:function(d,c){return h[d]?h[d](c):!1}}});n.when("A","publisherSubscriber").register("twister-dispatcher",function(d,k){function h(){h=1;return this}var f=d.$,c=new k,h=0,a=[];return{registerStore:function(a,d){c.register(a,d);return this},deregisterStore:function(a){c.deRegister(a);
return this},dispatch:function(d,e){h?a.push(arguments):c.publish(d,e);return this},hold:h,release:function(){f.each(a,function(a,d){c.publish.apply(c,d)});h=0;return this}}});n.when("A","publisherSubscriber").register("twister-view-controller",function(d,k){function h(){c?a.push(arguments):(c=1,f.publish.apply(f,arguments),c=0,a.length&&h.apply(this,a.shift()));return this}var f=new k,c=0,a=[];return{register:function(a,c){f.register(a,c);return this},deRegister:function(a){f.deRegister(a);
return this},publishView:h}});n.when("A").register("twister-dimsel-api",function(d){function k(d){var c=this;this.dimSelectionMap={};this.selInfo=d;h.each(d,function(a,d){c.dimSelectionMap[d.dimKey]=d.val})}var h=d.$;k.prototype={matches:function(d){d=d.selectionInfo();for(var c=0;c<d.length;c++){var a=d[c].dimKey;if(!(a in this.dimSelectionMap)||this.dimSelectionMap[a]!==d[c].val)return!1}return!0},selectionInfo:function(){return d.copy(this.selInfo)}};return k});n.when("A",
"twister-dimsel-api").register("twister-dim-util",function(d,k){function h(c){this.tvm=c;this.dimensionMetaData={};var a=[];c=c.dimensionInfo;for(var d=0;d<c.length;d++){a.push(c[d].dimKey);var e={};e.isRequired=c[d].isRequired;e.dimOrder=d;e.size=c[d].size;this.dimensionMetaData[c[d].dimKey]=e}}var f=d.$;h.prototype={createSelectionInfo:function(c){return new k(c)},extendSelectionInfo:function(c,a,d){var e=d||0===d,b={},h=[];f.each(a.selectionInfo(),function(a,c){b[c.dimKey]=c.val});f.each(c.selectionInfo(),
function(a,c){var f=c.dimKey,k=e?d:c.val;f in b&&(k=b[f]);h.push({dimKey:f,val:k})});return new k(h)},createNextDimSelection:function(c,a){var d=[],e=a.selectionInfo(),b=this;f.each(c.split(":"),function(a,c){var f=e[a].dimKey,h=parseInt(c,10);b.dimensionMetaData[f].isRequired&&h!==e[a].val&&(h=-1);d.push({dimKey:f,val:h})});return new k(d)},getDimScore:function(c,a){var d=0,e=c.split(":"),b=this;f.each(a.selectionInfo(),function(a,c){var f=c.dimKey,h=c.val,k=parseInt(e[a],10),n=e.length-a;h===k?
(d+=200*n,b.dimensionMetaData[f].isRequired&&(d+=2E4)):(h=Math.abs(h-k),f=Math.round(h/b.dimensionMetaData[f].size*100),d+=100-f)});return d},isSingletonDim:function(c){var a=0;this.tvm.config.isSingletonWeblabEnabled?1===this.tvm.dimtoValueMap[c].length&&(a=1):a=0;return a},isRequiredDim:function(c){return this.dimensionMetaData[c]?this.dimensionMetaData[c].isRequired:!1},getDimensionInfo:function(){return this.tvm.dimensionInfo},getDimAvailability:function(c,a){a=a.selectionInfo?a:this.createSelectionInfo(a);
var d=[],e=[],b=this.tvm.dimensionList,h=this.tvm.dimtoValueMap[c],l=this.createSelectionInfo([{dimKey:c,val:-1}]),l=this.tvm.fetch(this.extendSelectionInfo(a,l).selectionInfo()),k={},m=this;f.each(l,function(a,d){k[d.split(":")[b.indexOf(c)]]=m.tvm.dimCombinations[d]});f.each(h,function(b,a){b in k?d.push({index:b,asin:k[b],label:a}):e.push({index:b,label:a})});return{available:d,unavailable:e}},getUnselectedDims:function(c){var a={};f.each(c,function(b,c){a[c.dimKey]=c.val});c=[];var d=this.tvm.dimensionList,
e;for(e in d)if(d.hasOwnProperty(e)){var b=d[e];if(a[b]===u||-1===a[b])this.isSingletonDim(b)?a[b]=0:c.push(b)}return c},showDimSum:function(c,a){var d=this.getUnselectedDims(a);return!d||0===d.length||1===d.length&&d[0]===c?1:0},isFullySelected:function(c){var a=!0;"string"===typeof c&&(c=this.getSelectionInfoFromDimComb(c));c=c.selectionInfo?c.selectionInfo():c;if(c.length!=this.tvm.dimensionList.length)return!1;f.each(c,function(c,d){-1===d.val&&(a=!1)});return a},createDimensionSelectionMap:function(c){var a=
{},d;for(d in c)if(c.hasOwnProperty(d)){var e=c[d];a[e.dimKey]=e.val}return a},getSelectedDimKeys:function(c){var a=this.tvm.dimensionList,d=[],e;for(e in a)if(a.hasOwnProperty(e)){var b=c[a[e]];"undefined"===typeof b||-1==b?d.push("*"):d.push(b)}return d},getValidDimCombination:function(c,a){var d,e,b=this,h=0,l=0;e=this.tvm.fetch(c);f.each(e,function(c,e){l=b.getDimScore(e,a);l>h&&(d=c,h=l)});return e[d]},getAsinFromSelectionInfo:function(c,a){var g,e;"undefined"==typeof a||a?g=this.createDimensionSelectionMap(c):
(e=d.copy(c),g=this.getValidDimCombination(e,this.createSelectionInfo(c)),f.each(g.split(":"),function(b,a){var c=parseInt(a,10);e[b].val=c}),g=this.createDimensionSelectionMap(e));g=this.getSelectedDimKeys(g).join(":");return this.tvm.dimCombinations[g]},getSelectionInfoFromSelectedVariationValuesMap:function(c){var a=[],d;for(d in this.tvm.dimensionList){var e={},b=this.tvm.dimensionList[d];e.dimKey=b;e.val=c[b];a.push(e)}return a},getSelectionInfoFromDimComb:function(c){var a=[];c=c.split("_");
for(var d in this.tvm.dimensionList){var e={},b=c[d];e.dimKey=this.tvm.dimensionList[d];e.val="X"===b||"*"===b?-1:parseInt(b,10);a.push(e)}return a}};return h});n.when("A","url-builder").register("twister-dimsum",function(d,k){function h(c,a,g,e){this.cache;e&&(this.cache=new e);this.ajaxTimeout=c;this.batchLimit=10;this.ajaxUrl="/gp/twister/dimension?asinList=###asinString###&vs=1"+(a||"");g&&(this.ajaxUrl+="&deviceType="+g);(c=d.state("pwState"))&&c.isTryState&&(this.ajaxUrl=k.addUrlParams(this.ajaxUrl,
{isTryState:"true"}))}var f=d.$;h.prototype={get:function(c,a,g){function e(a){var c=a-this.batchLimit,g="";0<c&&e.call(this,c);if(g=k.slice(0>c?0:c,a).join(","))a=this.ajaxUrl.replace("###asinString###",g),d.ajax(a,{chunk:b,timeout:this.ajaxTimeout})}function b(b){if(b)for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];if(d&&d.asin){if(l){var e=h(d.asin,g);l.put(e,d)}a&&a(d)}}}function h(b,a){var c=b;d.objectIsEmpty(a)||(c={asin:b},f.extend(!0,c,a));return c}var l=this.cache,k=[],m={};f.each(c,function(b,
c){var d=h(c,g);l&&l.get(d)?a?a(l.get(d)):m[c]=l.get(d):k.push(c)});if(!a)return m;e.call(this,k.length)}};return h});n.when("A").register("twister-slots-dimsum",function(d){function k(a,c,d){this.cache=f;this.ajaxTimeout=a;this.batchLimit=8;this.ajaxUrl="/gp/twister/dimension?isDimensionSlotsAjax=1&asinList=###asinString###&vs=1"+(c||"");d&&(this.ajaxUrl+="&deviceType="+d)}var h=d.$,f={},c={};k.prototype={get:function(a,g){function e(a){var c=a-this.batchLimit,g="",h=[];0<c&&e.call(this,
c);h=k.slice(0>c?0:c,a);if(g=h.join(","))a=this.ajaxUrl.replace("###asinString###",g),d.ajax(a,{chunk:f,timeout:this.ajaxTimeout,cache:!0,error:b.apply(null,h)})}function b(){var b=arguments;return function(){d.each(b,function(b){delete c[b]})}}function f(b){if(b&&b.ASIN){var a=b.ASIN;l[a]=b;for(g&&g(b);c[a]&&c[a].length;)c[a].pop()(b);delete c[a]}}var l=this.cache,k=[],m={};h.each(a,function(b,a){l[a]?g?g(l[a]):m[a]=l[a]:c[a]&&g?c[a].push(g):g&&(k.push(a),c[a]=[])});if(!g)return m;k.length&&e.call(this,
k.length)}};return k});n.register("twister-metadata",function(){function d(){this.config={}}d.prototype={process:function(d,h,f){"METADATA"===d&&f(h)}};return d});n.when("A").register("publisherSubscriber",function(d){function k(){this.Subscribers=[];this.Names=[]}var h=d.$;k.prototype={register:function(f,c){if(-1<d.indexOfArray(this.Names,f))return!1;this.Names.push(f);this.Subscribers.push({name:f,handler:c})},deRegister:function(f){var c=d.indexOfArray(this.Names,f),
a=this,g=function(c,b){if(c.name===f)return a.Subscribers.splice(b,1),!0};return-1<c?(this.Names.splice(c,1),[].some?this.Subscribers.some(g):h.each(this.Subscribers,function(a,b){g(b,a)}),!0):!1},publish:function(){var d=arguments;h.each(this.Subscribers,function(c,a){setTimeout(function(){a.handler.apply(null,d)},0)})}};return k});n.when("jQuery").register("twister-state-machine",function(d){return function(k,h,f){function c(b,a){this.selected=function(){return b};this.peek=function(){return a}}
function a(b,a){var c=h.extendSelectionInfo(b,a);if(g(a)||k.exists(c.selectionInfo()))return c;for(var d=h.extendSelectionInfo(b,a,-1),d=k.fetch(d.selectionInfo()),e=0,f=0,n,p=0;p<d.length;p++)f=h.getDimScore(d[p],c),f>e&&(n=p,e=f);return h.createNextDimSelection(d[n],c)}function g(b){var a;d.each(b.selectionInfo(),function(b,c){a=-1===c.val});return a}function e(b,a){return{THEN:function(c){b&&c&&c(a());return this},ELSE:function(c){b||c&&c(a());return this}}}var b,n;this.accept=function(d,g){var f;
switch(d){case "VARIATION_PEEK":var k=h.createSelectionInfo(g);f=b();f.peek().matches(k)?f=!1:(-1===g.val?f=new c(b.selected(),b.selected()):(k=a(f.peek(),k),f=new c(f.selected(),k)),n=f,f=!0);f=e(f,this.currentState);break;case "VARIATION_CHANGE":f=b();var k=h.createSelectionInfo(g),p=h.getDimensionInfo();f.selected().matches(k)?f=!1:(f=k.selectionInfo().length!==p.length?a(f.selected(),k):k,n=new c(f,f),f=!0);f=e(f,this.currentState);break;default:f=e(!1)}return f};b=this.currentState=function(){return n};
(function(b){n=b})(new c(h.createSelectionInfo(f),h.createSelectionInfo(f)))}});n.when("A").register("twister-variation-matrix",function(d){function k(a){a=d.copy(a);var g=this;this.dimCombinations=a.dimCombinations;this.validCombinatonString=" "+d.keys(a.dimCombinations).join("  ")+" ";this.dimensionInfo=a.dimensionInfo;this.dimensionList=a.dimensionList;this.dimensionDisplayText=a.dimensionDisplayText;this.config=a.config;this.dimInfoMap={};c.each(this.dimensionInfo,function(a,b){var c=
b.dimKey,d={};d.size=b.size;d.dimOrder=a;g.dimInfoMap[c]=d});this.dimtoValueMap=a.dimtoValueMap}function h(a){a=c.map(a,function(a){a=a.val;return-1===a?"\\d+":""+a}).join(":");return new RegExp("\\s"+a+"\\s","gm")}function f(a){return c.map(a,function(a){return""+a.val}).join(":")}var c=d.$;k.prototype={fetch:function(a){a=h(a);a=this.validCombinatonString.match(a);return a=c.map(a,function(a){return a.trim()})},exists:function(a){return f(a)in this.dimCombinations}};return k});n.when("A",
"jQuery").register("url-builder",function(d,k){function h(a,c){var e;if(a&&c&&"object"==typeof c){e=a;var b="?";d.each(c,function(a,d){a=c[d];e+=b+d+"="+a;b="&"})}return e}function f(a){var c;a&&(c=a.split("?")[0]);return c}function c(a){var c={};a&&(a=a.split("?"),1<a.length&&(a=a[1].split("&"),d.each(a,function(a,b){var d=a.split("=");c[d[0]]=d[1]})));return c}return{addUrlParams:function(a,d){var e=a;if(a&&d&&"object"==typeof d)var e=f(a),b=c(a),b=k.extend(b,d),e=h(e,b);return e},removeUrlParams:function(a,
g){var e=a;if(a&&g&&"object"==typeof g){var e=f(a),b=c(a);d.each(g,function(a,c){delete b[a]});e=h(e,b)}return e}}})})})(function(){var n=window.AmazonUIPageJS||window.P,p=n._namespace||n.attributeErrors;return p?p("TwisterCoreAsset"):n}(),window);